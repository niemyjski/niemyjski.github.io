<!doctype html><html><head><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blakeniemyjski.com\/"},"articleSection":"programming","name":"How-to: Use a Stored Procedure extended property to preserve custom logic\nin generated CSLA code.","headline":"How-to: Use a Stored Procedure extended property to preserve custom logic\nin generated CSLA code.","description":"In the previous article on how to use the partial methods in the CodeSmith GeneratorCSLA templates to preserve custom code mostly focused on the code side of things. For those of you who might be using Stored Procedures might be wondering\x26hellip; How do I accomplish preserving my custom stored procedure logic? Don\x26rsquo;t worry, CodeSmith already though of this and didn\x26rsquo;t leave you out in the dark! The CSLA templates by default will not automatically execute the generated stored procedures but it can!","inLanguage":"en","author":"","creator":"","publisher":"","accountablePerson":"","copyrightHolder":"","copyrightYear":"30300","datePublished":"2010-07-30 17:39:02 \x2b0000 UTC","dateModified":"2010-07-30 17:39:02 \x2b0000 UTC","url":"https:\/\/blakeniemyjski.com\/programming\/how-to-use-a-stored-procedure-extended-property-to-preserve-custom-logic-in-generated-csla-code\/","wordCount":"1023","keywords":["CSLA","Blog"]}</script><title>How-to: Use a Stored Procedure extended property to preserve custom logic
in generated CSLA code.</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.63.2"><meta name=description content="Blake Niemyjski"><meta name=twitter:card content="summary"><meta name=twitter:title content="How-to: Use a Stored Procedure extended property to preserve custom logic
in generated CSLA code."><meta name=twitter:description content="In the previous article on how to use the partial methods in the CodeSmith GeneratorCSLA templates to preserve custom code mostly focused on the code side of things. For those of you who might be using Stored Procedures might be wondering&mldr; How do I accomplish preserving my custom stored procedure logic? Don&rsquo;t worry, CodeSmith already though of this and didn&rsquo;t leave you out in the dark! The CSLA templates by default will not automatically execute the generated stored procedures but it can!"><meta name=twitter:site content="@blaken"><meta property="og:title" content="How-to: Use a Stored Procedure extended property to preserve custom logic
in generated CSLA code."><meta property="og:description" content="In the previous article on how to use the partial methods in the CodeSmith GeneratorCSLA templates to preserve custom code mostly focused on the code side of things. For those of you who might be using Stored Procedures might be wondering&mldr; How do I accomplish preserving my custom stored procedure logic? Don&rsquo;t worry, CodeSmith already though of this and didn&rsquo;t leave you out in the dark! The CSLA templates by default will not automatically execute the generated stored procedures but it can!"><meta property="og:type" content="article"><meta property="og:url" content="https://blakeniemyjski.com/programming/how-to-use-a-stored-procedure-extended-property-to-preserve-custom-logic-in-generated-csla-code/"><meta property="article:published_time" content="2010-07-30T17:39:02+00:00"><meta property="article:modified_time" content="2010-07-30T17:39:02+00:00"><meta property="og:image" content="https://blakeniemyjski.com//images/logo.png"><meta property="og:image:type" content="image/png"><meta property="og:image:width" content="512"><meta property="og:image:height" content="512"><meta itemprop=name content="How-to: Use a Stored Procedure extended property to preserve custom logic
in generated CSLA code."><meta itemprop=description content="In the previous article on how to use the partial methods in the CodeSmith GeneratorCSLA templates to preserve custom code mostly focused on the code side of things. For those of you who might be using Stored Procedures might be wondering&mldr; How do I accomplish preserving my custom stored procedure logic? Don&rsquo;t worry, CodeSmith already though of this and didn&rsquo;t leave you out in the dark! The CSLA templates by default will not automatically execute the generated stored procedures but it can!"><meta itemprop=datePublished content="2010-07-30T17:39:02+00:00"><meta itemprop=dateModified content="2010-07-30T17:39:02+00:00"><meta itemprop=wordCount content="1023"><meta itemprop=keywords content="CSLA,"><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Raleway:400,800,900|Source+Sans+Pro:400,700"><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.12.0/css/all.css><script defer src=https://use.fontawesome.com/releases/v5.12.0/js/all.js></script><link rel=stylesheet href=https://blakeniemyjski.com/css/main.css><link href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css rel=stylesheet type=text/css><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-3422587-1','auto');ga('send','pageview');}</script></head><body><div id=wrapper><header id=header><h1><a href=https://blakeniemyjski.com/>programming</a></h1><nav class=links><ul><li><a href=https://blakeniemyjski.com/><i class="fas fa-home"></i>&nbsp;Home</a></li><li><a href=https://blakeniemyjski.com/categories/home-automation/><i class="fas fa-magic"></i>&nbsp;Home Automation</a></li><li><a href=https://blakeniemyjski.com/categories/programming/><i class="fas fa-code"></i>&nbsp;Programming</a></li><li><a href=https://blakeniemyjski.com/categories/review/><i class="fas fa-book"></i>&nbsp;Reviews</a></li><li><a href=https://blakeniemyjski.com/categories/public-speaking/><i class="fas fa-comments"></i>&nbsp;Public Speaking</a></li><li><a href=https://blakeniemyjski.com/about/><i class="fas fa-id-card"></i>&nbsp;About</a></li></ul></nav><nav class=main><ul><li id=share-nav class=share-menu style=display:none><a class=fa-share-alt href=#share-menu>Share</a></li><li class=search><a class=fa-search href=#search>Search</a><form id=search method=get action=//google.com/search><input type=text name=q placeholder=Search>
<input type=hidden name=as_sitesearch value=https://blakeniemyjski.com/></form></li><li class=menu><a class=fa-bars href=#menu>Menu</a></li></ul></nav></header><section id=menu><section><form class=search method=get action=//google.com/search><input type=text name=q placeholder=Search>
<input type=hidden name=as_sitesearch value=https://blakeniemyjski.com/></form></section><section><ul class=links><li><a href=https://blakeniemyjski.com/><h3><i class="fas fa-home"></i>&nbsp;Home</h3></a></li><li><a href=https://blakeniemyjski.com/categories/home-automation/><h3><i class="fas fa-magic"></i>&nbsp;Home Automation</h3></a></li><li><a href=https://blakeniemyjski.com/categories/programming/><h3><i class="fas fa-code"></i>&nbsp;Programming</h3></a></li><li><a href=https://blakeniemyjski.com/categories/review/><h3><i class="fas fa-book"></i>&nbsp;Reviews</h3></a></li><li><a href=https://blakeniemyjski.com/categories/public-speaking/><h3><i class="fas fa-comments"></i>&nbsp;Public Speaking</h3></a></li><li><a href=https://blakeniemyjski.com/about/><h3><i class="fas fa-id-card"></i>&nbsp;About</h3></a></li></ul></section><section class=recent-posts><div class=mini-posts><header><h3>Recent Posts</h3></header><article class=mini-post><header><h3><a href=https://blakeniemyjski.com/home-automation/hello-home-automation-how-to-detect-battery-levels-with-node-red/>Hello Home Automation, How to detect battery levels with Node-RED</a></h3><time class=published datetime=2020-02-03>February 3, 2020</time></header></article><article class=mini-post><header><h3><a href=https://blakeniemyjski.com/public-speaking/speaking-at-bam/>Speaking at BAM</a></h3><time class=published datetime=2019-02-19>February 19, 2019</time></header></article><article class=mini-post><header><h3><a href=https://blakeniemyjski.com/public-speaking/speaking-at-central-wisconsin-it-conference/>Speaking at Central Wisconsin It Conference</a></h3><time class=published datetime=2018-10-04>October 4, 2018</time></header></article><article class=mini-post><header><h3><a href=https://blakeniemyjski.com/public-speaking/speaking-at-the-northeast-wisconsin-code-camp/>Speaking at Northeast Wisconsin Code Camp</a></h3><time class=published datetime=2018-03-22>March 22, 2018</time></header></article><article class=mini-post><header><h3><a href=https://blakeniemyjski.com/public-speaking/speaking-at-milwaukee-code-camp/>Speaking at Milwaukee Code Camp</a></h3><time class=published datetime=2017-11-11>November 11, 2017</time></header></article><a href=/categories/ class=button>View more posts</a></div></section></section><section id=share-menu><section id=social-share-nav><ul class=links><header><h3>Share this post <i class="fas fa-smile"></i></h3></header><li><a href="//twitter.com/share?url=https%3a%2f%2fblakeniemyjski.com%2fprogramming%2fhow-to-use-a-stored-procedure-extended-property-to-preserve-custom-logic-in-generated-csla-code%2f&text=How-to%3a%20Use%20a%20Stored%20Procedure%20extended%20property%20to%20preserve%20custom%20logic%0ain%20generated%20CSLA%20code.&via=blaken" target=_blank rel=noopener class="share-btn twitter"><i class="fab fa-twitter"></i><p>Twitter</p></a></li><li><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblakeniemyjski.com%2fprogramming%2fhow-to-use-a-stored-procedure-extended-property-to-preserve-custom-logic-in-generated-csla-code%2f" target=_blank rel=noopener class="share-btn facebook"><i class="fab fa-facebook"></i><p>Facebook</p></a></li><li><a href="//reddit.com/submit?url=https%3a%2f%2fblakeniemyjski.com%2fprogramming%2fhow-to-use-a-stored-procedure-extended-property-to-preserve-custom-logic-in-generated-csla-code%2f&title=How-to%3a%20Use%20a%20Stored%20Procedure%20extended%20property%20to%20preserve%20custom%20logic%0ain%20generated%20CSLA%20code." target=_blank rel=noopener class="share-btn reddit"><i class="fab fa-reddit-alien"></i><p>Reddit</p></a></li><li><a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fblakeniemyjski.com%2fprogramming%2fhow-to-use-a-stored-procedure-extended-property-to-preserve-custom-logic-in-generated-csla-code%2f&title=How-to%3a%20Use%20a%20Stored%20Procedure%20extended%20property%20to%20preserve%20custom%20logic%0ain%20generated%20CSLA%20code." target=_blank rel=noopener class="share-btn linkedin"><i class="fab fa-linkedin"></i><p>LinkedIn</p></a></li><li><a href="mailto:?subject=Check out this post by &body=https%3a%2f%2fblakeniemyjski.com%2fprogramming%2fhow-to-use-a-stored-procedure-extended-property-to-preserve-custom-logic-in-generated-csla-code%2f" target=_blank rel=noopener class="share-btn email"><i class="fas fa-envelope"></i><p>Email</p></a></li></ul></section></section><div id=main><article class=post><header><div class=title><h1><a href=https://blakeniemyjski.com/programming/how-to-use-a-stored-procedure-extended-property-to-preserve-custom-logic-in-generated-csla-code/>How-to: Use a Stored Procedure extended property to preserve custom logic
in generated CSLA code.</a></h1></div><div class=meta><time class=published datetime=2010-07-30>July 30, 2010</time>
<span class=author></span><p>5 minute read</p></div></header><section id=social-share><ul class=icons><li><a href="//twitter.com/share?url=https%3a%2f%2fblakeniemyjski.com%2fprogramming%2fhow-to-use-a-stored-procedure-extended-property-to-preserve-custom-logic-in-generated-csla-code%2f&text=How-to%3a%20Use%20a%20Stored%20Procedure%20extended%20property%20to%20preserve%20custom%20logic%0ain%20generated%20CSLA%20code.&via=blaken" target=_blank rel=noopener class="share-btn twitter"><i class="fab fa-twitter"></i><p>Twitter</p></a></li><li><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fblakeniemyjski.com%2fprogramming%2fhow-to-use-a-stored-procedure-extended-property-to-preserve-custom-logic-in-generated-csla-code%2f" target=_blank rel=noopener class="share-btn facebook"><i class="fab fa-facebook"></i><p>Facebook</p></a></li><li><a href="//reddit.com/submit?url=https%3a%2f%2fblakeniemyjski.com%2fprogramming%2fhow-to-use-a-stored-procedure-extended-property-to-preserve-custom-logic-in-generated-csla-code%2f&title=How-to%3a%20Use%20a%20Stored%20Procedure%20extended%20property%20to%20preserve%20custom%20logic%0ain%20generated%20CSLA%20code." target=_blank rel=noopener class="share-btn reddit"><i class="fab fa-reddit-alien"></i><p>Reddit</p></a></li><li><a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fblakeniemyjski.com%2fprogramming%2fhow-to-use-a-stored-procedure-extended-property-to-preserve-custom-logic-in-generated-csla-code%2f&title=How-to%3a%20Use%20a%20Stored%20Procedure%20extended%20property%20to%20preserve%20custom%20logic%0ain%20generated%20CSLA%20code." target=_blank rel=noopener class="share-btn linkedin"><i class="fab fa-linkedin"></i><p>LinkedIn</p></a></li><li><a href="mailto:?subject=Check out this post by &body=https%3a%2f%2fblakeniemyjski.com%2fprogramming%2fhow-to-use-a-stored-procedure-extended-property-to-preserve-custom-logic-in-generated-csla-code%2f" target=_blank rel=noopener class="share-btn email"><i class="fas fa-envelope"></i><p>Email</p></a></li></ul></section><div id=content><p>In the <a href=https://blakeniemyjski.com/programming/csla/how-to-use-partial-methods-to-preserve-custom-csla-code-and-promote-active-regeneration/-promote-active-regeneration.aspx>previous article</a>
on how to use the partial methods in the <a href=http://www.codesmithtools.com/product/frameworks#csla>CodeSmith GeneratorCSLA templates</a>
to preserve custom code mostly focused on the code side of things. For those of
you who might be using Stored Procedures might be wondering&mldr; How do I
accomplish preserving my custom stored procedure logic? Don&rsquo;t worry, CodeSmith
already though of this and didn&rsquo;t leave you out in the dark! The CSLA templates
by default will not automatically execute the generated stored procedures but
it can! To do this you need to set the AutoExecuteStoredProcedures property to
True. Now, when your database related metadata changes so will your stored
procedures.</p><p>This is a great feature until you need to implement custom logic into your
stored procedure. By default we will generate logic that will prevent a stored
procedure from being overwritten if you have AutoExecuteStoredProcedures turned
to true or you try to drop the stored procedure. Here is the example that we
are going to be modifying that will result in the same exact output as our
previous sample.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>SET</span> NUMERIC_ROUNDABORT <span style=color:#66d9ef>OFF</span>
<span style=color:#66d9ef>GO</span>
<span style=color:#66d9ef>SET</span> ANSI_PADDING, ANSI_WARNINGS, CONCAT_NULL_YIELDS_NULL, ARITHABORT, QUOTED_IDENTIFIER, ANSI_NULLS <span style=color:#66d9ef>ON</span>
<span style=color:#66d9ef>GO</span>
<span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>EXISTS</span> (<span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> tempdb..sysobjects <span style=color:#66d9ef>WHERE</span> id<span style=color:#f92672>=</span>OBJECT_ID(<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>tempdb..#tmpErrors</span><span style=color:#e6db74>&#39;</span>)) <span style=color:#66d9ef>DROP</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#f92672>#</span>tmpErrors
<span style=color:#66d9ef>GO</span>
<span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#f92672>#</span>tmpErrors (Error int)
<span style=color:#66d9ef>GO</span>
<span style=color:#66d9ef>SET</span> XACT_ABORT <span style=color:#66d9ef>ON</span>
<span style=color:#66d9ef>GO</span>
<span style=color:#66d9ef>SET</span> <span style=color:#66d9ef>TRANSACTION</span> <span style=color:#66d9ef>ISOLATION</span> <span style=color:#66d9ef>LEVEL</span> <span style=color:#66d9ef>SERIALIZABLE</span>
<span style=color:#66d9ef>GO</span>
<span style=color:#66d9ef>BEGIN</span> <span style=color:#66d9ef>TRANSACTION</span>
<span style=color:#66d9ef>GO</span>
PRINT N<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>Dropping CSLA_Calendar_Select</span><span style=color:#e6db74>&#39;</span>
<span style=color:#66d9ef>GO</span>
<span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>EXISTS</span>(<span style=color:#66d9ef>SELECT</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>FROM</span> fn_listextendedproperty (<span style=color:#66d9ef>NULL</span>, <span style=color:#e6db74>&#39;</span><span style=color:#e6db74>SCHEMA</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74>&#39;</span><span style=color:#e6db74>dbo</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74>&#39;</span><span style=color:#e6db74>PROCEDURE</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74>&#39;</span><span style=color:#e6db74>CSLA_Calendar_Select</span><span style=color:#e6db74>&#39;</span>, <span style=color:#66d9ef>default</span>, <span style=color:#66d9ef>default</span>) <span style=color:#66d9ef>WHERE</span> name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;</span><span style=color:#e6db74>CustomProcedure</span><span style=color:#e6db74>&#39;</span> <span style=color:#66d9ef>and</span> value <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;</span><span style=color:#e6db74>1</span><span style=color:#e6db74>&#39;</span>)
<span style=color:#66d9ef>BEGIN</span>
    RAISERROR (<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>The procedure CSLA_Calendar_Select has an Extended Property &#34;CustomProcedure&#34; which means is has been customized. Please review and remove the property if you wish to drop the procedure.</span><span style=color:#e6db74>&#39;</span>,<span style=color:#ae81ff>16</span>,<span style=color:#ae81ff>1</span>)
    <span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#f92672>#</span>tmpErrors (Error) <span style=color:#66d9ef>SELECT</span> <span style=color:#ae81ff>1</span>
<span style=color:#66d9ef>END</span>
<span style=color:#66d9ef>GO</span>

<span style=color:#66d9ef>IF</span> OBJECT_ID(N<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>CSLA_Calendar_Select</span><span style=color:#e6db74>&#39;</span>) <span style=color:#66d9ef>IS</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>NULL</span>
  <span style=color:#66d9ef>DROP</span> <span style=color:#66d9ef>PROCEDURE</span> CSLA_Calendar_Select

<span style=color:#66d9ef>GO</span>
<span style=color:#66d9ef>IF</span> <span style=color:#f92672>@</span><span style=color:#f92672>@</span>ERROR<span style=color:#f92672>!</span><span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> <span style=color:#66d9ef>AND</span> <span style=color:#f92672>@</span><span style=color:#f92672>@</span>TRANCOUNT<span style=color:#f92672>&gt;</span><span style=color:#ae81ff>0</span> <span style=color:#66d9ef>ROLLBACK</span> <span style=color:#66d9ef>TRANSACTION</span>
<span style=color:#66d9ef>GO</span>

<span style=color:#66d9ef>IF</span> <span style=color:#f92672>@</span><span style=color:#f92672>@</span>TRANCOUNT<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> <span style=color:#66d9ef>BEGIN</span> <span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#f92672>#</span>tmpErrors (Error) <span style=color:#66d9ef>SELECT</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>BEGIN</span> <span style=color:#66d9ef>TRANSACTION</span> <span style=color:#66d9ef>END</span>
<span style=color:#66d9ef>GO</span>

<span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>EXISTS</span> (<span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> <span style=color:#f92672>#</span>tmpErrors) <span style=color:#66d9ef>ROLLBACK</span> <span style=color:#66d9ef>TRANSACTION</span>
<span style=color:#66d9ef>GO</span>

<span style=color:#66d9ef>IF</span> <span style=color:#f92672>@</span><span style=color:#f92672>@</span>TRANCOUNT<span style=color:#f92672>&gt;</span><span style=color:#ae81ff>0</span> <span style=color:#66d9ef>BEGIN</span>
PRINT <span style=color:#e6db74>&#39;</span><span style=color:#e6db74>The stored procedure drop has succeeded</span><span style=color:#e6db74>&#39;</span>
<span style=color:#66d9ef>COMMIT</span> <span style=color:#66d9ef>TRANSACTION</span>
<span style=color:#66d9ef>END</span>
<span style=color:#66d9ef>ELSE</span> PRINT <span style=color:#e6db74>&#39;</span><span style=color:#e6db74>The stored procedure drop has failed</span><span style=color:#e6db74>&#39;</span>
<span style=color:#66d9ef>GO</span>

<span style=color:#66d9ef>DROP</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#f92672>#</span>tmpErrors
<span style=color:#66d9ef>GO</span>

<span style=color:#75715e>--region [dbo].[CSLA_Calendar_Select]
</span><span style=color:#75715e></span>
<span style=color:#75715e>------------------------------------------------------------------------------------------------------------------------
</span><span style=color:#75715e></span><span style=color:#75715e>-- Generated By:   Blake Niemyjski using CodeSmith: v5.2.3, CSLA Templates: v3.0.0.1888, CSLA Framework: v3.8.4
</span><span style=color:#75715e></span><span style=color:#75715e>-- Procedure Name: [dbo].[CSLA_Calendar_Select]
</span><span style=color:#75715e></span><span style=color:#75715e>------------------------------------------------------------------------------------------------------------------------
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>SET</span> NUMERIC_ROUNDABORT <span style=color:#66d9ef>OFF</span>
<span style=color:#66d9ef>GO</span>
<span style=color:#66d9ef>SET</span> ANSI_PADDING, ANSI_WARNINGS, CONCAT_NULL_YIELDS_NULL, ARITHABORT, QUOTED_IDENTIFIER, ANSI_NULLS <span style=color:#66d9ef>ON</span>
<span style=color:#66d9ef>GO</span>
<span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>EXISTS</span> (<span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> tempdb..sysobjects <span style=color:#66d9ef>WHERE</span> id<span style=color:#f92672>=</span>OBJECT_ID(<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>tempdb..#tmpErrors</span><span style=color:#e6db74>&#39;</span>)) <span style=color:#66d9ef>DROP</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#f92672>#</span>tmpErrors
<span style=color:#66d9ef>GO</span>
<span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#f92672>#</span>tmpErrors (Error int)
<span style=color:#66d9ef>GO</span>
<span style=color:#66d9ef>SET</span> XACT_ABORT <span style=color:#66d9ef>ON</span>
<span style=color:#66d9ef>GO</span>
<span style=color:#66d9ef>SET</span> <span style=color:#66d9ef>TRANSACTION</span> <span style=color:#66d9ef>ISOLATION</span> <span style=color:#66d9ef>LEVEL</span> <span style=color:#66d9ef>SERIALIZABLE</span>
<span style=color:#66d9ef>GO</span>
<span style=color:#66d9ef>BEGIN</span> <span style=color:#66d9ef>TRANSACTION</span>
<span style=color:#66d9ef>GO</span>

PRINT N<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>Creating [dbo].[CSLA_Calendar_Select]</span><span style=color:#e6db74>&#39;</span>
<span style=color:#66d9ef>GO</span>

<span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>EXISTS</span>(<span style=color:#66d9ef>SELECT</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>FROM</span> fn_listextendedproperty (<span style=color:#66d9ef>NULL</span>, <span style=color:#e6db74>&#39;</span><span style=color:#e6db74>SCHEMA</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74>&#39;</span><span style=color:#e6db74>dbo</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74>&#39;</span><span style=color:#e6db74>PROCEDURE</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74>&#39;</span><span style=color:#e6db74>CSLA_Calendar_Select</span><span style=color:#e6db74>&#39;</span>, <span style=color:#66d9ef>default</span>, <span style=color:#66d9ef>default</span>) <span style=color:#66d9ef>WHERE</span> name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;</span><span style=color:#e6db74>CustomProcedure</span><span style=color:#e6db74>&#39;</span> <span style=color:#66d9ef>and</span> value <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;</span><span style=color:#e6db74>1</span><span style=color:#e6db74>&#39;</span>)
    <span style=color:#66d9ef>BEGIN</span>
        RAISERROR (<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>The procedure [dbo].[CSLA_Calendar_Select] has an Extended Property &#34;CustomProcedure&#34; which means is has been customized. Please review and remove the property if you wish to create the stored procedure.</span><span style=color:#e6db74>&#39;</span>,<span style=color:#ae81ff>16</span>,<span style=color:#ae81ff>1</span>)
        <span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#f92672>#</span>tmpErrors (Error) <span style=color:#66d9ef>SELECT</span> <span style=color:#ae81ff>1</span>
    <span style=color:#66d9ef>END</span>
<span style=color:#66d9ef>GO</span>

<span style=color:#66d9ef>CREATE</span> <span style=color:#66d9ef>PROCEDURE</span> [dbo].[CSLA_Calendar_Select]
  <span style=color:#f92672>@</span>p_ID nvarchar(<span style=color:#ae81ff>50</span>) <span style=color:#f92672>=</span> <span style=color:#66d9ef>NULL</span>,
  <span style=color:#f92672>@</span>p_CalendarName nvarchar(<span style=color:#ae81ff>50</span>) <span style=color:#f92672>=</span> <span style=color:#66d9ef>NULL</span>,
  <span style=color:#f92672>@</span>p_Name nvarchar(<span style=color:#ae81ff>50</span>) <span style=color:#f92672>=</span> <span style=color:#66d9ef>NULL</span>,
  <span style=color:#f92672>@</span>p_EventStart datetime <span style=color:#f92672>=</span> <span style=color:#66d9ef>NULL</span>,
  <span style=color:#f92672>@</span>p_EventEnd datetime <span style=color:#f92672>=</span> <span style=color:#66d9ef>NULL</span>,
  <span style=color:#f92672>@</span>p_Resource nvarchar(<span style=color:#ae81ff>150</span>) <span style=color:#f92672>=</span> <span style=color:#66d9ef>NULL</span>
<span style=color:#66d9ef>AS</span>

<span style=color:#66d9ef>SET</span> <span style=color:#66d9ef>TRANSACTION</span> <span style=color:#66d9ef>ISOLATION</span> <span style=color:#66d9ef>LEVEL</span> <span style=color:#66d9ef>READ</span> <span style=color:#66d9ef>COMMITTED</span>

<span style=color:#66d9ef>SELECT</span>
  [ID],
  [CalendarName],
  [Name],
  [EventStart],
  [EventEnd],
  [Resource]
<span style=color:#66d9ef>FROM</span>
    [dbo].[Calendar]
<span style=color:#66d9ef>WHERE</span>
  ([ID] <span style=color:#f92672>=</span> <span style=color:#f92672>@</span>p_ID <span style=color:#66d9ef>OR</span> <span style=color:#f92672>@</span>p_ID <span style=color:#66d9ef>IS</span> <span style=color:#66d9ef>NULL</span>)
  <span style=color:#66d9ef>AND</span> ([CalendarName] <span style=color:#f92672>=</span> <span style=color:#f92672>@</span>p_CalendarName <span style=color:#66d9ef>OR</span> <span style=color:#f92672>@</span>p_CalendarName <span style=color:#66d9ef>IS</span> <span style=color:#66d9ef>NULL</span>)
  <span style=color:#66d9ef>AND</span> ([Name] <span style=color:#f92672>=</span> <span style=color:#f92672>@</span>p_Name <span style=color:#66d9ef>OR</span> <span style=color:#f92672>@</span>p_Name <span style=color:#66d9ef>IS</span> <span style=color:#66d9ef>NULL</span>)
  <span style=color:#66d9ef>AND</span> ([EventStart] <span style=color:#f92672>=</span> <span style=color:#f92672>@</span>p_EventStart <span style=color:#66d9ef>OR</span> <span style=color:#f92672>@</span>p_EventStart <span style=color:#66d9ef>IS</span> <span style=color:#66d9ef>NULL</span>)
  <span style=color:#66d9ef>AND</span> ([EventEnd] <span style=color:#f92672>=</span> <span style=color:#f92672>@</span>p_EventEnd <span style=color:#66d9ef>OR</span> <span style=color:#f92672>@</span>p_EventEnd <span style=color:#66d9ef>IS</span> <span style=color:#66d9ef>NULL</span>)
  <span style=color:#66d9ef>AND</span> ([Resource] <span style=color:#f92672>=</span> <span style=color:#f92672>@</span>p_Resource <span style=color:#66d9ef>OR</span> <span style=color:#f92672>@</span>p_Resource <span style=color:#66d9ef>IS</span> <span style=color:#66d9ef>NULL</span>)

<span style=color:#66d9ef>GO</span>
<span style=color:#66d9ef>IF</span> <span style=color:#f92672>@</span><span style=color:#f92672>@</span>ERROR<span style=color:#f92672>!</span><span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> <span style=color:#66d9ef>AND</span> <span style=color:#f92672>@</span><span style=color:#f92672>@</span>TRANCOUNT<span style=color:#f92672>&gt;</span><span style=color:#ae81ff>0</span> <span style=color:#66d9ef>ROLLBACK</span> <span style=color:#66d9ef>TRANSACTION</span>
<span style=color:#66d9ef>GO</span>

<span style=color:#66d9ef>IF</span> <span style=color:#f92672>@</span><span style=color:#f92672>@</span>TRANCOUNT<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> <span style=color:#66d9ef>BEGIN</span> <span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> <span style=color:#f92672>#</span>tmpErrors (Error) <span style=color:#66d9ef>SELECT</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>BEGIN</span> <span style=color:#66d9ef>TRANSACTION</span> <span style=color:#66d9ef>END</span>
<span style=color:#66d9ef>GO</span>

<span style=color:#66d9ef>IF</span> <span style=color:#66d9ef>EXISTS</span> (<span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> <span style=color:#f92672>#</span>tmpErrors) <span style=color:#66d9ef>ROLLBACK</span> <span style=color:#66d9ef>TRANSACTION</span>
<span style=color:#66d9ef>GO</span>
<span style=color:#66d9ef>IF</span> <span style=color:#f92672>@</span><span style=color:#f92672>@</span>TRANCOUNT<span style=color:#f92672>&gt;</span><span style=color:#ae81ff>0</span> <span style=color:#66d9ef>BEGIN</span>
PRINT <span style=color:#e6db74>&#39;</span><span style=color:#e6db74>Stored procedure creation succeeded.</span><span style=color:#e6db74>&#39;</span>
<span style=color:#66d9ef>COMMIT</span> <span style=color:#66d9ef>TRANSACTION</span>
<span style=color:#66d9ef>END</span>
<span style=color:#66d9ef>ELSE</span> PRINT <span style=color:#e6db74>&#39;</span><span style=color:#e6db74>Stored procedure creation failed.</span><span style=color:#e6db74>&#39;</span>
<span style=color:#66d9ef>GO</span>
<span style=color:#66d9ef>DROP</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#f92672>#</span>tmpErrors
<span style=color:#66d9ef>GO</span>

<span style=color:#75715e>--endregion
</span></code></pre></div><p>Let&rsquo;s open up SQL Management Studio and run the script above. Once you run the
query above, you can see that the table was dropped and recreated.</p><pre><code class=language-output data-lang=output>Dropping CSLA_Calendar_Select
The stored procedure drop has succeeded
Creating [dbo].[CSLA_Calendar_Select]
Stored procedure creation succeeded.
</code></pre><p>Now that you can see that the stored procedure is being overwritten, let&rsquo;s
modify the stored procedure to return the same results as our previous example.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>ALTER</span> <span style=color:#66d9ef>PROCEDURE</span> [dbo].[CSLA_Calendar_Select]
  <span style=color:#f92672>@</span>p_ID nvarchar(<span style=color:#ae81ff>50</span>) <span style=color:#f92672>=</span> <span style=color:#66d9ef>NULL</span>,
  <span style=color:#f92672>@</span>p_CalendarName nvarchar(<span style=color:#ae81ff>50</span>) <span style=color:#f92672>=</span> <span style=color:#66d9ef>NULL</span>,
  <span style=color:#f92672>@</span>p_Name nvarchar(<span style=color:#ae81ff>50</span>) <span style=color:#f92672>=</span> <span style=color:#66d9ef>NULL</span>,
  <span style=color:#f92672>@</span>p_EventStart datetime <span style=color:#f92672>=</span> <span style=color:#66d9ef>NULL</span>,
  <span style=color:#f92672>@</span>p_EventEnd datetime <span style=color:#f92672>=</span> <span style=color:#66d9ef>NULL</span>,
  <span style=color:#f92672>@</span>p_Resource nvarchar(<span style=color:#ae81ff>150</span>) <span style=color:#f92672>=</span> <span style=color:#66d9ef>NULL</span>
<span style=color:#66d9ef>AS</span>

<span style=color:#66d9ef>SET</span> <span style=color:#66d9ef>TRANSACTION</span> <span style=color:#66d9ef>ISOLATION</span> <span style=color:#66d9ef>LEVEL</span> <span style=color:#66d9ef>READ</span> <span style=color:#66d9ef>COMMITTED</span>

<span style=color:#66d9ef>SELECT</span>
  [ID],
  [CalendarName],
  [Name],
  [EventStart],
  [EventEnd],
  [Resource]
<span style=color:#66d9ef>FROM</span>
    [dbo].[Calendar]
<span style=color:#66d9ef>WHERE</span>
  ([ID] <span style=color:#f92672>=</span> <span style=color:#f92672>@</span>p_ID <span style=color:#66d9ef>OR</span> <span style=color:#f92672>@</span>p_ID <span style=color:#66d9ef>IS</span> <span style=color:#66d9ef>NULL</span>)
  <span style=color:#66d9ef>AND</span> ([CalendarName] <span style=color:#f92672>=</span> <span style=color:#f92672>@</span>p_CalendarName <span style=color:#66d9ef>OR</span> <span style=color:#f92672>@</span>p_CalendarName <span style=color:#66d9ef>IS</span> <span style=color:#66d9ef>NULL</span>)
  <span style=color:#66d9ef>AND</span> ([Name] <span style=color:#f92672>=</span> <span style=color:#f92672>@</span>p_Name <span style=color:#66d9ef>OR</span> <span style=color:#f92672>@</span>p_Name <span style=color:#66d9ef>IS</span> <span style=color:#66d9ef>NULL</span>)
  <span style=color:#66d9ef>AND</span> ([EventStart] <span style=color:#f92672>=</span> <span style=color:#f92672>@</span>p_EventStart <span style=color:#66d9ef>OR</span> <span style=color:#f92672>@</span>p_EventStart <span style=color:#66d9ef>IS</span> <span style=color:#66d9ef>NULL</span>)
  <span style=color:#66d9ef>AND</span> ([EventEnd] <span style=color:#f92672>=</span> <span style=color:#f92672>@</span>p_EventEnd <span style=color:#66d9ef>OR</span> <span style=color:#f92672>@</span>p_EventEnd <span style=color:#66d9ef>IS</span> <span style=color:#66d9ef>NULL</span>)
  <span style=color:#66d9ef>AND</span> ([Resource] <span style=color:#f92672>=</span> <span style=color:#f92672>@</span>p_Resource <span style=color:#66d9ef>OR</span> <span style=color:#f92672>@</span>p_Resource <span style=color:#66d9ef>IS</span> <span style=color:#66d9ef>NULL</span>)
  <span style=color:#66d9ef>AND</span> [EventStart] <span style=color:#f92672>&gt;</span><span style=color:#f92672>=</span> <span style=color:#66d9ef>CONVERT</span>(varchar,DATEADD(<span style=color:#66d9ef>MONTH</span>,DATEDIFF(<span style=color:#66d9ef>MONTH</span>,<span style=color:#ae81ff>0</span>,GETDATE()),<span style=color:#ae81ff>0</span>),<span style=color:#ae81ff>101</span>)
</code></pre></div><p>Since you modified the stored procedure, you want to mark it as a custom Stored
Procedure. If you choose not to do this, then you will need to modify this
stored procedure any time you wish to regenerate or drop and recreate this
stored procedure. This can be done by right clicking on the stored procedure,
selecting properties and then selecting the Extended Properties node. You will
want to create a new extended property with a name of CustomProcedure and a
value of 1. The following SQL Script will also create the extended property.</p><p>![Stored Procedure Properties](/img/blog/Stored Procedure Properties - CSLA_Calendar_Select.png)</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>EXEC</span> sys.sp_addextendedproperty <span style=color:#f92672>@</span>name<span style=color:#f92672>=</span>N<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>CustomProcedure</span><span style=color:#e6db74>&#39;</span>, <span style=color:#f92672>@</span>value<span style=color:#f92672>=</span>N<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>1</span><span style=color:#e6db74>&#39;</span> , <span style=color:#f92672>@</span>level0type<span style=color:#f92672>=</span>N<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>SCHEMA</span><span style=color:#e6db74>&#39;</span>,<span style=color:#f92672>@</span>level0name<span style=color:#f92672>=</span>N<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>dbo</span><span style=color:#e6db74>&#39;</span>, <span style=color:#f92672>@</span>level1type<span style=color:#f92672>=</span>N<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>PROCEDURE</span><span style=color:#e6db74>&#39;</span>,<span style=color:#f92672>@</span>level1name<span style=color:#f92672>=</span>N<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>CSLA_Calendar_Select</span><span style=color:#e6db74>&#39;</span>
<span style=color:#66d9ef>GO</span>
</code></pre></div><p>Now when you execute the SQL script to drop and create the stored procedure it
will error out and preserve your changes!</p><pre><code class=language-output data-lang=output>Dropping CSLA_Calendar_Select
Msg 50000, Level 16, State 1, Line 3
The procedure CSLA_Calendar_Select has an Extended Property &quot;CustomProcedure&quot; which means is has been customized. Please review and remove the property if you wish to drop the procedure.

(1 row(s) affected)
The stored procedure drop has failed
Creating [dbo].[CSLA_Calendar_Select]
Msg 50000, Level 16, State 1, Line 4
The procedure [dbo].[CSLA_Calendar_Select] has an Extended Property &quot;CustomProcedure&quot; which means is has been customized. Please review and remove the property if you wish to create the stored procedure.

(1 row(s) affected)
Msg 2714, Level 16, State 3, Procedure CSLA_Calendar_Select, Line 13
There is already an object named 'CSLA_Calendar_Select' in the database.

(1 row(s) affected)
Stored procedure creation failed.
</code></pre></div><footer><ul class=stats><li class=categories><ul><i class="fas fa-folder"></i><li><a class=article-category-link href=https://blakeniemyjski.com/categories/programming>Programming</a></li></ul></li><li class=tags><ul><i class="fas fa-tags"></i><li><a class=article-category-link href=https://blakeniemyjski.com/tags/csla>CSLA</a></li></ul></li></ul></footer></article><article class=post><div class=disqus></div><script>(function(){var disqus_shortname='niemyjski';window.disqusLoaderSettings={element:'.disqus',options:{scriptUrl:'//'+disqus_shortname+'.disqus.com/embed.js',disqusConfig:function(){this.page.url="https:\/\/blakeniemyjski.com\/programming\/how-to-use-a-stored-procedure-extended-property-to-preserve-custom-logic-in-generated-csla-code\/";this.page.identifier="https:\/\/blakeniemyjski.com\/programming\/how-to-use-a-stored-procedure-extended-property-to-preserve-custom-logic-in-generated-csla-code\/";}}};})();</script></article><ul class="actions pagination"><li><a href=https://blakeniemyjski.com/programming/how-to-use-partial-methods-to-preserve-custom-csla-code-and-promote-active-regeneration/ class="button big previous">How-to: Use partial methods to preserve custom CSLA code and promote active regeneration.</a></li><li><a href=https://blakeniemyjski.com/programming/how-to-upgrade-a-community-server-website-thats-running-2.1-2007-or-2008-site-to-community-server-2008-or-telligent-community-5.5/ class="button big next">How-to: Upgrade a Community Server website thats running 2.1, 2007 or 2008 site to Community Server 2008 or Telligent Community 5.5</a></li></ul></div><section id=sidebar><section id=intro><a href=https://blakeniemyjski.com/><img src=https://blakeniemyjski.com/img/logo.jpeg class=intro-circle width=250 alt="Blake Niemyjski"></a><header><h2>Blake Niemyjski</h2><p>Passionate about building software</p></header><ul class=icons><li><a href=https://blakeniemyjski.com/index.xml type=application/rss+xml target=_blank title=RSS class="fas fa-rss"></a></li><li><a href=//github.com/niemyjski target=_blank title=GitHub class="fab fa-github"></a></li><li><a href=//stackoverflow.com/users/199701 target=_blank title="Stack Overflow" class="fab fa-stack-overflow"></a></li><li><a href=//linkedin.com/in/niemyjski target=_blank title=LinkedIn class="fab fa-linkedin"></a></li><li><a href=//reddit.com/user/bniemyjski target=_blank title=Reddit class="fab fa-reddit"></a></li><li><a href=//youtube.com/bniemyjski target=_blank title=YouTube class="fab fa-youtube"></a></li><li><a href=//twitter.com/blaken target=_blank title=Twitter class="fab fa-twitter"></a></li><li><a href=mailto:bniemyjski@gmail.com title=Email class="fas fa-envelope"></a></li></ul></section><section class=recent-posts><div class=mini-posts><header><h3>Recent Posts</h3></header><div class=posts-container><article class=mini-post><header><h3><a href=https://blakeniemyjski.com/home-automation/hello-home-automation-how-to-detect-battery-levels-with-node-red/>Hello Home Automation, How to detect battery levels with Node-RED</a></h3><time class=published datetime=2020-02-03>February 3, 2020</time></header></article><article class=mini-post><header><h3><a href=https://blakeniemyjski.com/public-speaking/speaking-at-bam/>Speaking at BAM</a></h3><time class=published datetime=2019-02-19>February 19, 2019</time></header></article><article class=mini-post><header><h3><a href=https://blakeniemyjski.com/public-speaking/speaking-at-central-wisconsin-it-conference/>Speaking at Central Wisconsin It Conference</a></h3><time class=published datetime=2018-10-04>October 4, 2018</time></header></article><article class=mini-post><header><h3><a href=https://blakeniemyjski.com/public-speaking/speaking-at-the-northeast-wisconsin-code-camp/>Speaking at Northeast Wisconsin Code Camp</a></h3><time class=published datetime=2018-03-22>March 22, 2018</time></header></article><article class=mini-post><header><h3><a href=https://blakeniemyjski.com/public-speaking/speaking-at-milwaukee-code-camp/>Speaking at Milwaukee Code Camp</a></h3><time class=published datetime=2017-11-11>November 11, 2017</time></header></article></div><a href=/categories/ class=button>View more posts</a></div></section><section id=mini-bio><h3>About</h3><p>Blake Niemyjski is a full time open source software architect and private pilot. Since the late 90's, Blake's curiosity has been focused around developing software that helps the masses. As a hobbyist developer turned student and professional, Blake's passion is to further his knowledge and create technologies for the future.</p><a href=https://blakeniemyjski.com/about/ class=button>Learn More</a></section><section id=footer><p class=copyright>&copy; 2020
Blake Niemyjski
.
Powered by <a href=//gohugo.io target=_blank>Hugo</a></p></section></section></div><a id=back-to-top href=# class="fas fa-arrow-up fa-border fa-2x"></a><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script><script>hljs.initHighlightingOnLoad();</script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/skel/3.0.1/skel.min.js></script><script src=https://blakeniemyjski.com/js/util.js></script><script src=https://blakeniemyjski.com/js/main.js></script><script src=https://blakeniemyjski.com/js/backToTop.js></script><script defer async src=https://blakeniemyjski.com/js/disqusLoader.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>